{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\nimport React, { useCallback, useEffect, useImperativeHandle, useMemo, useRef, useState } from 'react';\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Keyboard from \"react-native-web/dist/exports/Keyboard\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport View from \"react-native-web/dist/exports/View\";\nimport I18nManager from \"react-native-web/dist/exports/I18nManager\";\nimport CInput from \"../TextInput\";\nimport { useDeviceOrientation } from \"../../useDeviceOrientation\";\nimport { useDetectDevice } from \"../../toolkits\";\nimport { styles } from \"./styles\";\nimport _ from 'lodash';\nvar isTablet = useDetectDevice.isTablet,\n    isIOS = useDetectDevice.isIOS;\n\nvar ic_down = require(\"../../assets/down.png\");\n\nvar defaultProps = {\n  placeholder: 'Select item',\n  activeColor: '#F6F7F8',\n  data: [],\n  style: {},\n  selectedTextProps: {}\n};\nvar DropdownComponent = React.forwardRef(function (props, currentRef) {\n  var orientation = useDeviceOrientation();\n  var testID = props.testID,\n      itemTestIDField = props.itemTestIDField,\n      onChange = props.onChange,\n      style = props.style,\n      containerStyle = props.containerStyle,\n      placeholderStyle = props.placeholderStyle,\n      selectedTextStyle = props.selectedTextStyle,\n      inputSearchStyle = props.inputSearchStyle,\n      iconStyle = props.iconStyle,\n      selectedTextProps = props.selectedTextProps,\n      data = props.data,\n      labelField = props.labelField,\n      valueField = props.valueField,\n      value = props.value,\n      activeColor = props.activeColor,\n      fontFamily = props.fontFamily,\n      _props$iconColor = props.iconColor,\n      iconColor = _props$iconColor === void 0 ? 'gray' : _props$iconColor,\n      searchPlaceholder = props.searchPlaceholder,\n      placeholder = props.placeholder,\n      _props$search = props.search,\n      search = _props$search === void 0 ? false : _props$search,\n      _props$maxHeight = props.maxHeight,\n      maxHeight = _props$maxHeight === void 0 ? 340 : _props$maxHeight,\n      _props$disable = props.disable,\n      disable = _props$disable === void 0 ? false : _props$disable,\n      _props$keyboardAvoidi = props.keyboardAvoiding,\n      keyboardAvoiding = _props$keyboardAvoidi === void 0 ? true : _props$keyboardAvoidi,\n      renderLeftIcon = props.renderLeftIcon,\n      renderRightIcon = props.renderRightIcon,\n      renderItem = props.renderItem,\n      renderInputSearch = props.renderInputSearch,\n      onFocus = props.onFocus,\n      onBlur = props.onBlur,\n      _props$autoScroll = props.autoScroll,\n      autoScroll = _props$autoScroll === void 0 ? true : _props$autoScroll,\n      _props$showsVerticalS = props.showsVerticalScrollIndicator,\n      showsVerticalScrollIndicator = _props$showsVerticalS === void 0 ? true : _props$showsVerticalS,\n      _props$dropdownPositi = props.dropdownPosition,\n      dropdownPosition = _props$dropdownPositi === void 0 ? 'auto' : _props$dropdownPositi,\n      flatListProps = props.flatListProps,\n      searchQuery = props.searchQuery,\n      statusBarIsTranslucent = props.statusBarIsTranslucent,\n      backgroundColor = props.backgroundColor;\n  var ref = useRef(null);\n  var refList = useRef(null);\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      visible = _useState2[0],\n      setVisible = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentValue = _useState4[0],\n      setCurrentValue = _useState4[1];\n\n  var _useState5 = useState(data),\n      _useState6 = _slicedToArray(_useState5, 2),\n      listData = _useState6[0],\n      setListData = _useState6[1];\n\n  var _useState7 = useState(),\n      _useState8 = _slicedToArray(_useState7, 2),\n      position = _useState8[0],\n      setPosition = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      focus = _useState10[0],\n      setFocus = _useState10[1];\n\n  var _useState11 = useState(0),\n      _useState12 = _slicedToArray(_useState11, 2),\n      keyboardHeight = _useState12[0],\n      setKeyboardHeight = _useState12[1];\n\n  var _Dimensions$get = Dimensions.get('window'),\n      W = _Dimensions$get.width,\n      H = _Dimensions$get.height;\n\n  var styleContainerVertical = useMemo(function () {\n    return {\n      backgroundColor: 'rgba(0,0,0,0.1)',\n      alignItems: 'center'\n    };\n  }, []);\n  var styleHorizontal = useMemo(function () {\n    return {\n      marginBottom: 20,\n      width: W / 2,\n      alignSelf: 'center'\n    };\n  }, [W]);\n  useImperativeHandle(currentRef, function () {\n    return {\n      open: eventOpen,\n      close: eventClose\n    };\n  });\n  useEffect(function () {\n    setListData(_toConsumableArray(data));\n  }, [data]);\n\n  var eventOpen = function eventOpen() {\n    if (!disable) {\n      setVisible(true);\n\n      if (onFocus) {\n        onFocus();\n      }\n    }\n  };\n\n  var eventClose = useCallback(function () {\n    if (!disable) {\n      setVisible(false);\n\n      if (onBlur) {\n        onBlur();\n      }\n    }\n  }, [disable, onBlur]);\n  var font = useCallback(function () {\n    if (fontFamily) {\n      return {\n        fontFamily: fontFamily\n      };\n    } else {\n      return {};\n    }\n  }, [fontFamily]);\n\n  var _measure = useCallback(function () {\n    if (ref && ref !== null && ref !== void 0 && ref.current) {\n      ref.current.measure(function (_width, _height, px, py, fx, fy) {\n        var isFull = orientation === 'LANDSCAPE' && !isTablet;\n        var w = Math.floor(px);\n        var top = isFull ? 20 : Math.floor(py) + Math.floor(fy) + 2;\n        var bottom = H - top;\n        var left = I18nManager.isRTL ? W - Math.floor(px) - Math.floor(fx) : Math.floor(fx);\n        setPosition({\n          isFull: isFull,\n          w: w,\n          top: top,\n          bottom: Math.floor(bottom),\n          left: left,\n          height: Math.floor(py)\n        });\n      });\n    }\n  }, [H, W, orientation]);\n\n  var onKeyboardDidShow = useCallback(function (e) {\n    _measure();\n\n    setKeyboardHeight(e.endCoordinates.height);\n  }, [_measure]);\n\n  var onKeyboardDidHide = function onKeyboardDidHide() {\n    setKeyboardHeight(0);\n  };\n\n  useEffect(function () {\n    var susbcriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', onKeyboardDidShow);\n    var susbcriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', onKeyboardDidHide);\n    return function () {\n      if (typeof (susbcriptionKeyboardDidShow === null || susbcriptionKeyboardDidShow === void 0 ? void 0 : susbcriptionKeyboardDidShow.remove) === 'function') {\n        susbcriptionKeyboardDidShow.remove();\n      } else {\n        Keyboard.removeListener('keyboardDidShow', onKeyboardDidShow);\n      }\n\n      if (typeof (susbcriptionKeyboardDidHide === null || susbcriptionKeyboardDidHide === void 0 ? void 0 : susbcriptionKeyboardDidHide.remove) === 'function') {\n        susbcriptionKeyboardDidHide.remove();\n      } else {\n        Keyboard.removeListener('keyboardDidHide', onKeyboardDidHide);\n      }\n    };\n  }, [onKeyboardDidShow]);\n  var getValue = useCallback(function () {\n    var getItem = data.filter(function (e) {\n      return _.isEqual(value, _.get(e, valueField));\n    });\n\n    if (getItem.length > 0) {\n      setCurrentValue(getItem[0]);\n    } else {\n      setCurrentValue(null);\n    }\n  }, [data, value, valueField]);\n  useEffect(function () {\n    getValue();\n  }, [value, data, getValue]);\n  var scrollIndex = useCallback(function () {\n    if (autoScroll && data.length > 0 && listData.length === data.length) {\n      setTimeout(function () {\n        if (refList && refList !== null && refList !== void 0 && refList.current) {\n          var index = _.findIndex(listData, function (e) {\n            return _.isEqual(value, _.get(e, valueField));\n          });\n\n          if (index > -1 && index <= listData.length - 1) {\n            var _refList$current;\n\n            refList === null || refList === void 0 ? void 0 : (_refList$current = refList.current) === null || _refList$current === void 0 ? void 0 : _refList$current.scrollToIndex({\n              index: index,\n              animated: false\n            });\n          }\n        }\n      }, 200);\n    }\n  }, [autoScroll, data.length, listData, value, valueField]);\n  var showOrClose = useCallback(function () {\n    if (!disable) {\n      _measure();\n\n      setVisible(!visible);\n      setListData(data);\n\n      if (!visible) {\n        if (onFocus) {\n          onFocus();\n        }\n      } else {\n        if (onBlur) {\n          onBlur();\n        }\n      }\n    }\n\n    scrollIndex();\n  }, [_measure, data, disable, onBlur, onFocus, scrollIndex, visible]);\n  var onSearch = useCallback(function (text) {\n    if (text.length > 0) {\n      var defaultFilterFunction = function defaultFilterFunction(e) {\n        var _$get;\n\n        var item = (_$get = _.get(e, labelField)) === null || _$get === void 0 ? void 0 : _$get.toLowerCase().replace(' ', '').normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n        var key = text.toLowerCase().replace(' ', '').normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n        return item.indexOf(key) >= 0;\n      };\n\n      var propSearchFunction = function propSearchFunction(e) {\n        var labelText = _.get(e, labelField);\n\n        return searchQuery === null || searchQuery === void 0 ? void 0 : searchQuery(text, labelText);\n      };\n\n      var dataSearch = data.filter(searchQuery ? propSearchFunction : defaultFilterFunction);\n      setListData(dataSearch);\n    } else {\n      setListData(data);\n    }\n  }, [data, labelField, searchQuery]);\n  var onSelect = useCallback(function (item) {\n    onSearch('');\n    setCurrentValue(item);\n    onChange(item);\n    eventClose();\n  }, [eventClose, onChange, onSearch]);\n\n  var _renderDropdown = function _renderDropdown() {\n    var isSelected = currentValue && _.get(currentValue, valueField);\n\n    return React.createElement(TouchableWithoutFeedback, {\n      testID: testID,\n      onPress: showOrClose\n    }, React.createElement(View, {\n      style: styles.dropdown\n    }, renderLeftIcon === null || renderLeftIcon === void 0 ? void 0 : renderLeftIcon(), React.createElement(Text, _extends({\n      style: [styles.textItem, isSelected !== null ? selectedTextStyle : placeholderStyle, font()]\n    }, selectedTextProps), isSelected !== null ? _.get(currentValue, labelField) : placeholder), renderRightIcon ? renderRightIcon() : React.createElement(Image, {\n      source: ic_down,\n      style: [styles.icon, {\n        tintColor: iconColor\n      }, iconStyle]\n    })));\n  };\n\n  var _renderItem = useCallback(function (_ref) {\n    var item = _ref.item,\n        index = _ref.index;\n\n    var isSelected = currentValue && _.get(currentValue, valueField);\n\n    var selected = _.isEqual(_.get(item, valueField), isSelected);\n\n    return React.createElement(TouchableOpacity, {\n      testID: _.get(item, itemTestIDField || labelField),\n      key: index,\n      onPress: function onPress() {\n        return onSelect(item);\n      },\n      style: [selected && {\n        backgroundColor: activeColor\n      }]\n    }, renderItem ? renderItem(item, selected) : React.createElement(View, {\n      style: styles.item\n    }, React.createElement(Text, {\n      style: [styles.textItem, font()]\n    }, _.get(item, labelField))));\n  }, [activeColor, currentValue, font, itemTestIDField, labelField, onSelect, renderItem, valueField]);\n\n  var renderSearch = useCallback(function () {\n    if (search) {\n      if (renderInputSearch) {\n        return renderInputSearch(function (text) {\n          onSearch(text);\n        });\n      } else {\n        return React.createElement(CInput, {\n          testID: testID + ' input',\n          style: [styles.input, inputSearchStyle],\n          inputStyle: [inputSearchStyle, font()],\n          autoCorrect: false,\n          keyboardType: isIOS ? 'default' : 'visible-password',\n          placeholder: searchPlaceholder,\n          onChangeText: onSearch,\n          placeholderTextColor: \"gray\",\n          iconStyle: [{\n            tintColor: iconColor\n          }, iconStyle],\n          onFocus: function onFocus() {\n            return setFocus(true);\n          },\n          onBlur: function onBlur() {\n            setFocus(false);\n          }\n        });\n      }\n    }\n\n    return null;\n  }, [font, iconColor, iconStyle, inputSearchStyle, onSearch, renderInputSearch, search, searchPlaceholder, testID]);\n\n  var _renderListTop = useCallback(function () {\n    return React.createElement(TouchableWithoutFeedback, null, React.createElement(View, {\n      style: styles.flexShrink\n    }, React.createElement(FlatList, _extends({\n      testID: testID + ' flatlist'\n    }, flatListProps, {\n      keyboardShouldPersistTaps: \"handled\",\n      ref: refList,\n      onScrollToIndexFailed: scrollIndex,\n      data: listData,\n      inverted: true,\n      renderItem: _renderItem,\n      keyExtractor: function keyExtractor(_item, index) {\n        return index.toString();\n      },\n      showsVerticalScrollIndicator: showsVerticalScrollIndicator\n    })), renderSearch()));\n  }, [_renderItem, flatListProps, listData, renderSearch, scrollIndex, showsVerticalScrollIndicator, testID]);\n\n  var _renderListBottom = useCallback(function () {\n    return React.createElement(TouchableWithoutFeedback, null, React.createElement(View, {\n      style: styles.flexShrink\n    }, renderSearch(), React.createElement(FlatList, _extends({\n      testID: testID + ' flatlist'\n    }, flatListProps, {\n      keyboardShouldPersistTaps: \"handled\",\n      ref: refList,\n      onScrollToIndexFailed: scrollIndex,\n      data: listData,\n      renderItem: _renderItem,\n      keyExtractor: function keyExtractor(_item, index) {\n        return index.toString();\n      },\n      showsVerticalScrollIndicator: showsVerticalScrollIndicator\n    }))));\n  }, [_renderItem, flatListProps, listData, renderSearch, scrollIndex, showsVerticalScrollIndicator, testID]);\n\n  var _renderModal = useCallback(function () {\n    if (visible && position) {\n      var isFull = position.isFull,\n          w = position.w,\n          top = position.top,\n          bottom = position.bottom,\n          left = position.left,\n          height = position.height;\n\n      if (w && top && bottom) {\n        var styleVertical = {\n          left: left,\n          maxHeight: maxHeight\n        };\n        var isTopPosition = dropdownPosition === 'auto' ? bottom < (isIOS ? 200 : search ? 310 : 300) : dropdownPosition === 'top' ? true : false;\n        var topHeight = isTopPosition ? top - height : top;\n        var keyboardStyle = {};\n\n        if (keyboardAvoiding) {\n          if (renderInputSearch) {\n            if (keyboardHeight > 0 && bottom < keyboardHeight + height) {\n              if (isTopPosition) {\n                topHeight = H - keyboardHeight;\n              } else {\n                keyboardStyle = {\n                  backgroundColor: 'rgba(0,0,0,0.1)'\n                };\n                topHeight = H - keyboardHeight - 55;\n              }\n            }\n          } else {\n            if (focus && keyboardHeight > 0 && bottom < keyboardHeight + height) {\n              if (isTopPosition) {\n                topHeight = H - keyboardHeight;\n              } else {\n                keyboardStyle = {\n                  backgroundColor: 'rgba(0,0,0,0.1)'\n                };\n                topHeight = H - keyboardHeight - 55;\n              }\n            }\n          }\n        }\n\n        return React.createElement(Modal, {\n          transparent: true,\n          statusBarTranslucent: statusBarIsTranslucent,\n          visible: visible,\n          supportedOrientations: ['landscape', 'portrait'],\n          onRequestClose: showOrClose\n        }, React.createElement(TouchableWithoutFeedback, {\n          onPress: showOrClose\n        }, React.createElement(View, {\n          style: [styles.flex1, isFull && styleContainerVertical, backgroundColor && {\n            backgroundColor: backgroundColor\n          }, keyboardStyle]\n        }, React.createElement(View, {\n          style: [styles.wrapTop, {\n            height: topHeight,\n            width: w\n          }]\n        }, isTopPosition && React.createElement(View, {\n          style: [{\n            width: w\n          }, styles.container, containerStyle, isFull ? styleHorizontal : styleVertical]\n        }, _renderListTop())), React.createElement(View, {\n          style: styles.flex1\n        }, !isTopPosition && React.createElement(View, {\n          style: [{\n            width: w\n          }, styles.container, containerStyle, isFull ? styleHorizontal : styleVertical]\n        }, _renderListBottom())))));\n      }\n\n      return null;\n    }\n\n    return null;\n  }, [visible, position, maxHeight, dropdownPosition, search, keyboardAvoiding, statusBarIsTranslucent, showOrClose, styleContainerVertical, backgroundColor, containerStyle, styleHorizontal, _renderListTop, _renderListBottom, renderInputSearch, keyboardHeight, H, focus]);\n\n  return React.createElement(View, {\n    style: [styles.mainWrap, style],\n    ref: ref,\n    onLayout: _measure\n  }, _renderDropdown(), _renderModal());\n});\nDropdownComponent.defaultProps = defaultProps;\nexport default DropdownComponent;","map":{"version":3,"sources":["index.tsx"],"names":["isIOS","ic_down","require","defaultProps","placeholder","activeColor","data","style","selectedTextProps","DropdownComponent","orientation","useDeviceOrientation","iconColor","search","maxHeight","disable","keyboardAvoiding","autoScroll","showsVerticalScrollIndicator","dropdownPosition","backgroundColor","ref","useRef","refList","useState","width","height","H","Dimensions","styleContainerVertical","useMemo","alignItems","styleHorizontal","marginBottom","W","alignSelf","useImperativeHandle","open","close","eventClose","useEffect","setListData","eventOpen","setVisible","onFocus","useCallback","onBlur","font","fontFamily","_measure","isFull","w","Math","top","bottom","left","I18nManager","setPosition","onKeyboardDidShow","e","setKeyboardHeight","onKeyboardDidHide","susbcriptionKeyboardDidShow","Keyboard","susbcriptionKeyboardDidHide","getValue","getItem","_","setCurrentValue","scrollIndex","listData","setTimeout","index","animated","showOrClose","onSearch","text","defaultFilterFunction","item","key","propSearchFunction","labelText","searchQuery","dataSearch","onSelect","onChange","_renderDropdown","isSelected","currentValue","styles","dropdown","renderLeftIcon","renderRightIcon","tintColor","_renderItem","selected","itemTestIDField","renderItem","renderSearch","renderInputSearch","testID","setFocus","_renderListTop","flexShrink","_renderListBottom","_renderModal","visible","styleVertical","isTopPosition","topHeight","keyboardStyle","keyboardHeight","focus","flex1"],"mappings":"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","sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  Dimensions,\n  FlatList,\n  Image,\n  Keyboard,\n  Modal,\n  Text,\n  TouchableOpacity,\n  TouchableWithoutFeedback,\n  View,\n  ViewStyle,\n  KeyboardEvent,\n  I18nManager,\n} from 'react-native';\nimport CInput from '../TextInput';\nimport { useDeviceOrientation } from '../../useDeviceOrientation';\nimport { useDetectDevice } from '../../toolkits';\nimport { styles } from './styles';\nimport type { DropdownProps } from './model';\nimport _ from 'lodash';\n\nconst { isTablet, isIOS } = useDetectDevice;\nconst ic_down = require('../../assets/down.png');\n\nconst defaultProps = {\n  placeholder: 'Select item',\n  activeColor: '#F6F7F8',\n  data: [],\n  style: {},\n  selectedTextProps: {},\n};\n\nconst DropdownComponent = React.forwardRef<any, DropdownProps>(\n  (props, currentRef) => {\n    const orientation = useDeviceOrientation();\n    const {\n      testID,\n      itemTestIDField,\n      onChange,\n      style,\n      containerStyle,\n      placeholderStyle,\n      selectedTextStyle,\n      inputSearchStyle,\n      iconStyle,\n      selectedTextProps,\n      data,\n      labelField,\n      valueField,\n      value,\n      activeColor,\n      fontFamily,\n      iconColor = 'gray',\n      searchPlaceholder,\n      placeholder,\n      search = false,\n      maxHeight = 340,\n      disable = false,\n      keyboardAvoiding = true,\n      renderLeftIcon,\n      renderRightIcon,\n      renderItem,\n      renderInputSearch,\n      onFocus,\n      onBlur,\n      autoScroll = true,\n      showsVerticalScrollIndicator = true,\n      dropdownPosition = 'auto',\n      flatListProps,\n      searchQuery,\n      statusBarIsTranslucent,\n      backgroundColor,\n    } = props;\n\n    const ref = useRef<View>(null);\n    const refList = useRef<FlatList>(null);\n    const [visible, setVisible] = useState<boolean>(false);\n    const [currentValue, setCurrentValue] = useState<any>(null);\n    const [listData, setListData] = useState<any[]>(data);\n    const [position, setPosition] = useState<any>();\n    const [focus, setFocus] = useState<boolean>(false);\n    const [keyboardHeight, setKeyboardHeight] = useState<number>(0);\n\n    const { width: W, height: H } = Dimensions.get('window');\n    const styleContainerVertical: ViewStyle = useMemo(() => {\n      return {\n        backgroundColor: 'rgba(0,0,0,0.1)',\n        alignItems: 'center',\n      };\n    }, []);\n    const styleHorizontal: ViewStyle = useMemo(() => {\n      return {\n        marginBottom: 20,\n        width: W / 2,\n        alignSelf: 'center',\n      };\n    }, [W]);\n\n    useImperativeHandle(currentRef, () => {\n      return { open: eventOpen, close: eventClose };\n    });\n\n    useEffect(() => {\n      setListData([...data]);\n    }, [data]);\n\n    const eventOpen = () => {\n      if (!disable) {\n        setVisible(true);\n        if (onFocus) {\n          onFocus();\n        }\n      }\n    };\n\n    const eventClose = useCallback(() => {\n      if (!disable) {\n        setVisible(false);\n        if (onBlur) {\n          onBlur();\n        }\n      }\n    }, [disable, onBlur]);\n\n    const font = useCallback(() => {\n      if (fontFamily) {\n        return {\n          fontFamily: fontFamily,\n        };\n      } else {\n        return {};\n      }\n    }, [fontFamily]);\n\n    const _measure = useCallback(() => {\n      if (ref && ref?.current) {\n        ref.current.measure((_width, _height, px, py, fx, fy) => {\n          const isFull = orientation === 'LANDSCAPE' && !isTablet;\n          const w = Math.floor(px);\n          const top = isFull ? 20 : Math.floor(py) + Math.floor(fy) + 2;\n          const bottom = H - top;\n          const left = I18nManager.isRTL\n            ? W - Math.floor(px) - Math.floor(fx)\n            : Math.floor(fx);\n\n          setPosition({\n            isFull,\n            w,\n            top,\n            bottom: Math.floor(bottom),\n            left,\n            height: Math.floor(py),\n          });\n        });\n      }\n    }, [H, W, orientation]);\n\n    const onKeyboardDidShow = useCallback(\n      (e: KeyboardEvent) => {\n        _measure();\n        setKeyboardHeight(e.endCoordinates.height);\n      },\n      [_measure]\n    );\n\n    const onKeyboardDidHide = () => {\n      setKeyboardHeight(0);\n    };\n\n    useEffect(() => {\n      const susbcriptionKeyboardDidShow = Keyboard.addListener(\n        'keyboardDidShow',\n        onKeyboardDidShow\n      );\n      const susbcriptionKeyboardDidHide = Keyboard.addListener(\n        'keyboardDidHide',\n        onKeyboardDidHide\n      );\n\n      return () => {\n        if (typeof susbcriptionKeyboardDidShow?.remove === 'function') {\n          susbcriptionKeyboardDidShow.remove();\n        } else {\n          Keyboard.removeListener('keyboardDidShow', onKeyboardDidShow);\n        }\n\n        if (typeof susbcriptionKeyboardDidHide?.remove === 'function') {\n          susbcriptionKeyboardDidHide.remove();\n        } else {\n          Keyboard.removeListener('keyboardDidHide', onKeyboardDidHide);\n        }\n      };\n    }, [onKeyboardDidShow]);\n\n    const getValue = useCallback(() => {\n      const getItem = data.filter((e) =>\n        _.isEqual(value, _.get(e, valueField))\n      );\n      if (getItem.length > 0) {\n        setCurrentValue(getItem[0]);\n      } else {\n        setCurrentValue(null);\n      }\n    }, [data, value, valueField]);\n\n    useEffect(() => {\n      getValue();\n    }, [value, data, getValue]);\n\n    const scrollIndex = useCallback(() => {\n      if (autoScroll && data.length > 0 && listData.length === data.length) {\n        setTimeout(() => {\n          if (refList && refList?.current) {\n            const index = _.findIndex(listData, (e: any) =>\n              _.isEqual(value, _.get(e, valueField))\n            );\n            if (index > -1 && index <= listData.length - 1) {\n              refList?.current?.scrollToIndex({\n                index: index,\n                animated: false,\n              });\n            }\n          }\n        }, 200);\n      }\n    }, [autoScroll, data.length, listData, value, valueField]);\n\n    const showOrClose = useCallback(() => {\n      if (!disable) {\n        _measure();\n        setVisible(!visible);\n        setListData(data);\n\n        if (!visible) {\n          if (onFocus) {\n            onFocus();\n          }\n        } else {\n          if (onBlur) {\n            onBlur();\n          }\n        }\n      }\n      scrollIndex();\n    }, [_measure, data, disable, onBlur, onFocus, scrollIndex, visible]);\n\n    const onSearch = useCallback(\n      (text: string) => {\n        if (text.length > 0) {\n          const defaultFilterFunction = (e: any) => {\n            const item = _.get(e, labelField)\n              ?.toLowerCase()\n              .replace(' ', '')\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n            const key = text\n              .toLowerCase()\n              .replace(' ', '')\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '');\n\n            return item.indexOf(key) >= 0;\n          };\n\n          const propSearchFunction = (e: any) => {\n            const labelText = _.get(e, labelField);\n\n            return searchQuery?.(text, labelText);\n          };\n\n          const dataSearch = data.filter(\n            searchQuery ? propSearchFunction : defaultFilterFunction\n          );\n          setListData(dataSearch);\n        } else {\n          setListData(data);\n        }\n      },\n      [data, labelField, searchQuery]\n    );\n\n    const onSelect = useCallback(\n      (item: any) => {\n        onSearch('');\n        setCurrentValue(item);\n        onChange(item);\n        eventClose();\n      },\n      [eventClose, onChange, onSearch]\n    );\n\n    const _renderDropdown = () => {\n      const isSelected = currentValue && _.get(currentValue, valueField);\n      return (\n        <TouchableWithoutFeedback testID={testID} onPress={showOrClose}>\n          <View style={styles.dropdown}>\n            {renderLeftIcon?.()}\n            <Text\n              style={[\n                styles.textItem,\n                isSelected !== null ? selectedTextStyle : placeholderStyle,\n                font(),\n              ]}\n              {...selectedTextProps}\n            >\n              {isSelected !== null\n                ? _.get(currentValue, labelField)\n                : placeholder}\n            </Text>\n            {renderRightIcon ? (\n              renderRightIcon()\n            ) : (\n              <Image\n                source={ic_down}\n                style={[styles.icon, { tintColor: iconColor }, iconStyle]}\n              />\n            )}\n          </View>\n        </TouchableWithoutFeedback>\n      );\n    };\n\n    const _renderItem = useCallback(\n      ({ item, index }: { item: any; index: number }) => {\n        const isSelected = currentValue && _.get(currentValue, valueField);\n        const selected = _.isEqual(_.get(item, valueField), isSelected);\n        return (\n          <TouchableOpacity\n            testID={_.get(item, itemTestIDField || labelField)}\n            key={index}\n            onPress={() => onSelect(item)}\n            style={[\n              selected && {\n                backgroundColor: activeColor,\n              },\n            ]}\n          >\n            {renderItem ? (\n              renderItem(item, selected)\n            ) : (\n              <View style={styles.item}>\n                <Text style={[styles.textItem, font()]}>\n                  {_.get(item, labelField)}\n                </Text>\n              </View>\n            )}\n          </TouchableOpacity>\n        );\n      },\n      [\n        activeColor,\n        currentValue,\n        font,\n        itemTestIDField,\n        labelField,\n        onSelect,\n        renderItem,\n        valueField,\n      ]\n    );\n\n    const renderSearch = useCallback(() => {\n      if (search) {\n        if (renderInputSearch) {\n          return renderInputSearch((text) => {\n            onSearch(text);\n          });\n        } else {\n          return (\n            <CInput\n              testID={testID + ' input'}\n              style={[styles.input, inputSearchStyle]}\n              inputStyle={[inputSearchStyle, font()]}\n              autoCorrect={false}\n              keyboardType={isIOS ? 'default' : 'visible-password'}\n              placeholder={searchPlaceholder}\n              onChangeText={onSearch}\n              placeholderTextColor=\"gray\"\n              iconStyle={[{ tintColor: iconColor }, iconStyle]}\n              onFocus={() => setFocus(true)}\n              onBlur={() => {\n                setFocus(false);\n              }}\n            />\n          );\n        }\n      }\n      return null;\n    }, [\n      font,\n      iconColor,\n      iconStyle,\n      inputSearchStyle,\n      onSearch,\n      renderInputSearch,\n      search,\n      searchPlaceholder,\n      testID,\n    ]);\n\n    const _renderListTop = useCallback(() => {\n      return (\n        <TouchableWithoutFeedback>\n          <View style={styles.flexShrink}>\n            <FlatList\n              testID={testID + ' flatlist'}\n              {...flatListProps}\n              keyboardShouldPersistTaps=\"handled\"\n              ref={refList}\n              onScrollToIndexFailed={scrollIndex}\n              data={listData}\n              inverted\n              renderItem={_renderItem}\n              keyExtractor={(_item, index) => index.toString()}\n              showsVerticalScrollIndicator={showsVerticalScrollIndicator}\n            />\n            {renderSearch()}\n          </View>\n        </TouchableWithoutFeedback>\n      );\n    }, [\n      _renderItem,\n      flatListProps,\n      listData,\n      renderSearch,\n      scrollIndex,\n      showsVerticalScrollIndicator,\n      testID,\n    ]);\n\n    const _renderListBottom = useCallback(() => {\n      return (\n        <TouchableWithoutFeedback>\n          <View style={styles.flexShrink}>\n            {renderSearch()}\n            <FlatList\n              testID={testID + ' flatlist'}\n              {...flatListProps}\n              keyboardShouldPersistTaps=\"handled\"\n              ref={refList}\n              onScrollToIndexFailed={scrollIndex}\n              data={listData}\n              renderItem={_renderItem}\n              keyExtractor={(_item, index) => index.toString()}\n              showsVerticalScrollIndicator={showsVerticalScrollIndicator}\n            />\n          </View>\n        </TouchableWithoutFeedback>\n      );\n    }, [\n      _renderItem,\n      flatListProps,\n      listData,\n      renderSearch,\n      scrollIndex,\n      showsVerticalScrollIndicator,\n      testID,\n    ]);\n\n    const _renderModal = useCallback(() => {\n      if (visible && position) {\n        const { isFull, w, top, bottom, left, height } = position;\n        if (w && top && bottom) {\n          const styleVertical: ViewStyle = { left: left, maxHeight: maxHeight };\n          const isTopPosition =\n            dropdownPosition === 'auto'\n              ? bottom < (isIOS ? 200 : search ? 310 : 300)\n              : dropdownPosition === 'top'\n              ? true\n              : false;\n          let topHeight = isTopPosition ? top - height : top;\n\n          let keyboardStyle: ViewStyle = {};\n\n          if (keyboardAvoiding) {\n            if (renderInputSearch) {\n              if (keyboardHeight > 0 && bottom < keyboardHeight + height) {\n                if (isTopPosition) {\n                  topHeight = H - keyboardHeight;\n                } else {\n                  keyboardStyle = { backgroundColor: 'rgba(0,0,0,0.1)' };\n                  topHeight = H - keyboardHeight - 55;\n                }\n              }\n            } else {\n              if (\n                focus &&\n                keyboardHeight > 0 &&\n                bottom < keyboardHeight + height\n              ) {\n                if (isTopPosition) {\n                  topHeight = H - keyboardHeight;\n                } else {\n                  keyboardStyle = { backgroundColor: 'rgba(0,0,0,0.1)' };\n                  topHeight = H - keyboardHeight - 55;\n                }\n              }\n            }\n          }\n\n          return (\n            <Modal\n              transparent\n              statusBarTranslucent={statusBarIsTranslucent}\n              visible={visible}\n              supportedOrientations={['landscape', 'portrait']}\n              onRequestClose={showOrClose}\n            >\n              <TouchableWithoutFeedback onPress={showOrClose}>\n                <View\n                  style={[\n                    styles.flex1,\n                    isFull && styleContainerVertical,\n                    backgroundColor && { backgroundColor: backgroundColor },\n                    keyboardStyle,\n                  ]}\n                >\n                  <View\n                    style={[\n                      styles.wrapTop,\n                      {\n                        height: topHeight,\n                        width: w,\n                      },\n                    ]}\n                  >\n                    {isTopPosition && (\n                      <View\n                        style={[\n                          { width: w },\n                          styles.container,\n                          containerStyle,\n                          isFull ? styleHorizontal : styleVertical,\n                        ]}\n                      >\n                        {_renderListTop()}\n                      </View>\n                    )}\n                  </View>\n                  <View style={styles.flex1}>\n                    {!isTopPosition && (\n                      <View\n                        style={[\n                          { width: w },\n                          styles.container,\n                          containerStyle,\n                          isFull ? styleHorizontal : styleVertical,\n                        ]}\n                      >\n                        {_renderListBottom()}\n                      </View>\n                    )}\n                  </View>\n                </View>\n              </TouchableWithoutFeedback>\n            </Modal>\n          );\n        }\n        return null;\n      }\n      return null;\n    }, [\n      visible,\n      position,\n      maxHeight,\n      dropdownPosition,\n      search,\n      keyboardAvoiding,\n      statusBarIsTranslucent,\n      showOrClose,\n      styleContainerVertical,\n      backgroundColor,\n      containerStyle,\n      styleHorizontal,\n      _renderListTop,\n      _renderListBottom,\n      renderInputSearch,\n      keyboardHeight,\n      H,\n      focus,\n    ]);\n\n    return (\n      <View style={[styles.mainWrap, style]} ref={ref} onLayout={_measure}>\n        {_renderDropdown()}\n        {_renderModal()}\n      </View>\n    );\n  }\n);\n\nDropdownComponent.defaultProps = defaultProps;\n\nexport default DropdownComponent;\n"]},"metadata":{},"sourceType":"module"}